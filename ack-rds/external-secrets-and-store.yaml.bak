---
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: rosa-rds-secret-store
  annotations:
    argocd.argoproj.io/sync-wave: "-5"
spec:
  provider:
    aws:
      service: SecretsManager
      region: __REGION__
      auth:
        jwt:
          serviceAccountRef:
              name: iam-external-secrets-rds-sa
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  namespace: ack-system
  name: rosa-rds-shared-instance-credentials
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: rosa-rds-secret-store
    kind: SecretStore
  target:
    name: ack-rds-user-secrets
    creationPolicy: Owner
  dataFrom:
  - extract:
      key: ack-rds-user-secrets

--
apiVersion: v1
data:
  ACK_ENABLE_DEVELOPMENT_LOGGING: "true"
  ACK_LOG_LEVEL: debug
  ACK_RESOURCE_TAGS: 
  ACK_WATCH_NAMESPACE: ""
  AWS_ENDPOINT_URL: ""
  AWS_REGION: __REGION__
kind: ConfigMap
metadata:
  name: ack-rds-user-config
  namespace: ack-system
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  namespace: ack-system
  name: rosa-rds-shared-instance-credentials
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: rosa-rds-secret-store
    kind: SecretStore
  target:
    name: rosa-rds-shared-instance-credentials
    creationPolicy: Owner
  dataFrom:
  - extract:
      key: rosa-rds-shared-instance-credentials

